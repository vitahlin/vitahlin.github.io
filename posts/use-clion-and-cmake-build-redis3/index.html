<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>macOS上用Clion CMake编译redis 3.0 - Vitah Lin</title><meta name=description content="相关版本说明  redis：3.0.0 macOS：11.2.3 CMake：3.19.6 Clion：2020.3.2  克隆redis3.0源代码 去Github上面下载3.0版本的代码：https://codeload.github.com/redis/redis/zip/3.0 解压后将目录redis-3.0重新命名为redis 。
创建对应的CMakeLists.txt 使用cmake 编译redis 源码的话需要创建对应的CMakeLists.txt 文件，创建完成后，直接在redis 目录执行命令cmake . 即可。
redis/deps/hiredis/CMakeLists.txt add_library(hiredis STATIC  hiredis.c net.c dict.c net.c sds.c async.c  ) redis/deps/linenoise/CMakeLists.txt add_library(linenoise linenoise.c) redis/deps/lua/CMakeLists.txt set(LUA_SRC  src/lapi.c src/lcode.c src/ldebug.c src/ldo.c src/ldump.c src/lfunc.c  src/lgc.c src/llex.c src/lmem.c src/lobject.c src/lopcodes.c src/lparser.c  src/lstate.c src/lstring.c src/ltable.c src/ltm.c src/lundump.c src/lvm.c  src/lzio.c src/strbuf.c src/fpconv.c src/lauxlib.c src/lbaselib.c src/ldblib.c  src/liolib.c src/lmathlib.c src/loslib.c src/ltablib.c src/lstrlib.c src/loadlib."><meta name=author content="vitahlin"><link rel="preload stylesheet" as=style href=https://www.vitahlin.com/app.min.css><link rel="preload stylesheet" as=style href=https://www.vitahlin.com/an-old-hope.min.css><script defer src=https://www.vitahlin.com/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://www.vitahlin.com/theme.png><link rel=preload as=image href=https://www.vitahlin.com/github.svg><link rel=icon href=https://www.vitahlin.com/favicon.ico><link rel=apple-touch-icon href=https://www.vitahlin.com/apple-touch-icon.png><meta name=generator content="Hugo 0.96.0"><meta property="og:title" content="macOS上用Clion CMake编译redis 3.0"><meta property="og:description" content="相关版本说明  redis：3.0.0 macOS：11.2.3 CMake：3.19.6 Clion：2020.3.2  克隆redis3.0源代码 去Github上面下载3.0版本的代码：https://codeload.github.com/redis/redis/zip/3.0 解压后将目录redis-3.0重新命名为redis 。
创建对应的CMakeLists.txt 使用cmake 编译redis 源码的话需要创建对应的CMakeLists.txt 文件，创建完成后，直接在redis 目录执行命令cmake . 即可。
redis/deps/hiredis/CMakeLists.txt add_library(hiredis STATIC  hiredis.c net.c dict.c net.c sds.c async.c  ) redis/deps/linenoise/CMakeLists.txt add_library(linenoise linenoise.c) redis/deps/lua/CMakeLists.txt set(LUA_SRC  src/lapi.c src/lcode.c src/ldebug.c src/ldo.c src/ldump.c src/lfunc.c  src/lgc.c src/llex.c src/lmem.c src/lobject.c src/lopcodes.c src/lparser.c  src/lstate.c src/lstring.c src/ltable.c src/ltm.c src/lundump.c src/lvm.c  src/lzio.c src/strbuf.c src/fpconv.c src/lauxlib.c src/lbaselib.c src/ldblib.c  src/liolib.c src/lmathlib.c src/loslib.c src/ltablib.c src/lstrlib.c src/loadlib."><meta property="og:type" content="article"><meta property="og:url" content="https://www.vitahlin.com/posts/use-clion-and-cmake-build-redis3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-19T21:57:40+08:00"><meta property="article:modified_time" content="2022-02-19T16:45:40+08:00"><meta itemprop=name content="macOS上用Clion CMake编译redis 3.0"><meta itemprop=description content="相关版本说明  redis：3.0.0 macOS：11.2.3 CMake：3.19.6 Clion：2020.3.2  克隆redis3.0源代码 去Github上面下载3.0版本的代码：https://codeload.github.com/redis/redis/zip/3.0 解压后将目录redis-3.0重新命名为redis 。
创建对应的CMakeLists.txt 使用cmake 编译redis 源码的话需要创建对应的CMakeLists.txt 文件，创建完成后，直接在redis 目录执行命令cmake . 即可。
redis/deps/hiredis/CMakeLists.txt add_library(hiredis STATIC  hiredis.c net.c dict.c net.c sds.c async.c  ) redis/deps/linenoise/CMakeLists.txt add_library(linenoise linenoise.c) redis/deps/lua/CMakeLists.txt set(LUA_SRC  src/lapi.c src/lcode.c src/ldebug.c src/ldo.c src/ldump.c src/lfunc.c  src/lgc.c src/llex.c src/lmem.c src/lobject.c src/lopcodes.c src/lparser.c  src/lstate.c src/lstring.c src/ltable.c src/ltm.c src/lundump.c src/lvm.c  src/lzio.c src/strbuf.c src/fpconv.c src/lauxlib.c src/lbaselib.c src/ldblib.c  src/liolib.c src/lmathlib.c src/loslib.c src/ltablib.c src/lstrlib.c src/loadlib."><meta itemprop=datePublished content="2022-02-19T21:57:40+08:00"><meta itemprop=dateModified content="2022-02-19T16:45:40+08:00"><meta itemprop=wordCount content="248"><meta itemprop=keywords content="redis,"><meta name=twitter:card content="summary"><meta name=twitter:title content="macOS上用Clion CMake编译redis 3.0"><meta name=twitter:description content="相关版本说明  redis：3.0.0 macOS：11.2.3 CMake：3.19.6 Clion：2020.3.2  克隆redis3.0源代码 去Github上面下载3.0版本的代码：https://codeload.github.com/redis/redis/zip/3.0 解压后将目录redis-3.0重新命名为redis 。
创建对应的CMakeLists.txt 使用cmake 编译redis 源码的话需要创建对应的CMakeLists.txt 文件，创建完成后，直接在redis 目录执行命令cmake . 即可。
redis/deps/hiredis/CMakeLists.txt add_library(hiredis STATIC  hiredis.c net.c dict.c net.c sds.c async.c  ) redis/deps/linenoise/CMakeLists.txt add_library(linenoise linenoise.c) redis/deps/lua/CMakeLists.txt set(LUA_SRC  src/lapi.c src/lcode.c src/ldebug.c src/ldo.c src/ldump.c src/lfunc.c  src/lgc.c src/llex.c src/lmem.c src/lobject.c src/lopcodes.c src/lparser.c  src/lstate.c src/lstring.c src/ltable.c src/ltm.c src/lundump.c src/lvm.c  src/lzio.c src/strbuf.c src/fpconv.c src/lauxlib.c src/lbaselib.c src/ldblib.c  src/liolib.c src/lmathlib.c src/loslib.c src/ltablib.c src/lstrlib.c src/loadlib."></head><body class=not-ready data-menu=true><header class=header><p class=logo><a class=site-name href=https://www.vitahlin.com/>Vitah Lin</a><a class=btn-dark></a></p><script>let bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>{bodyClx[e?"add":"remove"]("dark"),localStorage.setItem("dark",e?"yes":"no")};setDark(darkVal?darkVal==="yes":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",e=>setDark(e.matches))</script><nav class=menu><a href=/about/>About</a></nav><nav class=social><a class=github style=--url:url(./github.svg) href=https://github.com/vitahlin target=_blank></a></nav></header><main class=main><article class=post-single><header class=post-title><p><time>Feb 19, 2022</time>
<span>vitahlin</span></p><h1>macOS上用Clion CMake编译redis 3.0</h1></header><section class=post-content><h2 id=相关版本说明>相关版本说明</h2><ul><li><strong>redis：3.0.0</strong></li><li><strong>macOS：11.2.3</strong></li><li><strong>CMake：3.19.6</strong></li><li><strong>Clion：2020.3.2</strong></li></ul><h2 id=克隆redis30源代码>克隆redis3.0源代码</h2><p>去Github上面下载3.0版本的代码：<a href=https://codeload.github.com/redis/redis/zip/3.0>https://codeload.github.com/redis/redis/zip/3.0</a>
解压后将目录<code>redis-3.0</code>重新命名为<code>redis</code> 。</p><h2 id=创建对应的cmakeliststxt>创建对应的CMakeLists.txt</h2><p>使用<code>cmake</code> 编译<code>redis</code> 源码的话需要创建对应的<code>CMakeLists.txt</code> 文件，创建完成后，直接在<code>redis</code> 目录执行命令<code>cmake .</code> 即可。</p><h3 id=redisdepshirediscmakeliststxt>redis/deps/hiredis/CMakeLists.txt</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>add_library(hiredis STATIC
</span></span><span style=display:flex><span>        hiredis.c net.c dict.c net.c sds.c async.c
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><h3 id=redisdepslinenoisecmakeliststxt>redis/deps/linenoise/CMakeLists.txt</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>add_library(linenoise linenoise.c)
</span></span></code></pre></div><h3 id=redisdepsluacmakeliststxt>redis/deps/lua/CMakeLists.txt</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>set(LUA_SRC
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>lapi.c src<span style=color:#f92672>/</span>lcode.c src<span style=color:#f92672>/</span>ldebug.c src<span style=color:#f92672>/</span>ldo.c src<span style=color:#f92672>/</span>ldump.c src<span style=color:#f92672>/</span>lfunc.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>lgc.c src<span style=color:#f92672>/</span>llex.c src<span style=color:#f92672>/</span>lmem.c src<span style=color:#f92672>/</span>lobject.c src<span style=color:#f92672>/</span>lopcodes.c src<span style=color:#f92672>/</span>lparser.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>lstate.c src<span style=color:#f92672>/</span>lstring.c src<span style=color:#f92672>/</span>ltable.c src<span style=color:#f92672>/</span>ltm.c src<span style=color:#f92672>/</span>lundump.c src<span style=color:#f92672>/</span>lvm.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>lzio.c src<span style=color:#f92672>/</span>strbuf.c src<span style=color:#f92672>/</span>fpconv.c src<span style=color:#f92672>/</span>lauxlib.c src<span style=color:#f92672>/</span>lbaselib.c src<span style=color:#f92672>/</span>ldblib.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>liolib.c src<span style=color:#f92672>/</span>lmathlib.c src<span style=color:#f92672>/</span>loslib.c src<span style=color:#f92672>/</span>ltablib.c src<span style=color:#f92672>/</span>lstrlib.c src<span style=color:#f92672>/</span>loadlib.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>linit.c src<span style=color:#f92672>/</span>lua_cjson.c src<span style=color:#f92672>/</span>lua_struct.c src<span style=color:#f92672>/</span>lua_cmsgpack.c src<span style=color:#f92672>/</span>lua_bit.c
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>add_library(lua STATIC <span style=color:#960050;background-color:#1e0010>$</span>{LUA_SRC})
</span></span></code></pre></div><h3 id=redisdepscmakeliststxt>redis/deps/CMakeLists.txt</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>add_subdirectory(hiredis)
</span></span><span style=display:flex><span>add_subdirectory(linenoise)
</span></span><span style=display:flex><span>add_subdirectory(lua)
</span></span></code></pre></div><h3 id=rediscmakeliststxt>redis/CMakeLists.txt</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>cmake_minimum_required(VERSION <span style=color:#ae81ff>3.0</span> FATAL_ERROR)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>project(redis3<span style=color:#ae81ff>.0</span> VERSION <span style=color:#ae81ff>3.0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set(CMAKE_BUILD_TYPE <span style=color:#e6db74>&#34;Debug&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_filename_component(REDIS_ROOT <span style=color:#e6db74>&#34;${CMAKE_CURRENT_SOURCE_DIR}&#34;</span> ABSOLUTE)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_subdirectory(deps)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set(SRC_SERVER src<span style=color:#f92672>/</span>redis.c
</span></span><span style=display:flex><span>        <span style=color:#75715e>## 解决mac下编译报错问题
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>## src/ae_epoll.c src/ae_evport.c src/ae_select.c src/ae_kqueue.c
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        src<span style=color:#f92672>/</span>adlist.c src<span style=color:#f92672>/</span>ae.c src<span style=color:#f92672>/</span>anet.c src<span style=color:#f92672>/</span>aof.c src<span style=color:#f92672>/</span>asciilogo.h src<span style=color:#f92672>/</span>bio.c src<span style=color:#f92672>/</span>bitops.c src<span style=color:#f92672>/</span>blocked.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>cluster.c src<span style=color:#f92672>/</span>config.c src<span style=color:#f92672>/</span>crc64.c src<span style=color:#f92672>/</span>crc16.c src<span style=color:#f92672>/</span>db.c src<span style=color:#f92672>/</span>debug.c src<span style=color:#f92672>/</span>dict.c src<span style=color:#f92672>/</span>endianconv.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>hyperloglog.c src<span style=color:#f92672>/</span>intset.c src<span style=color:#f92672>/</span>latency.c src<span style=color:#f92672>/</span>lzf_c.c src<span style=color:#f92672>/</span>lzf_d.c src<span style=color:#f92672>/</span>memtest.c src<span style=color:#f92672>/</span>multi.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>networking.c src<span style=color:#f92672>/</span>notify.c src<span style=color:#f92672>/</span>object.c src<span style=color:#f92672>/</span>pqsort.c src<span style=color:#f92672>/</span>pubsub.c src<span style=color:#f92672>/</span>rand.c src<span style=color:#f92672>/</span>rdb.c src<span style=color:#f92672>/</span>release.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>replication.c src<span style=color:#f92672>/</span>rio.c src<span style=color:#f92672>/</span>scripting.c src<span style=color:#f92672>/</span>sds.c src<span style=color:#f92672>/</span>sentinel.c src<span style=color:#f92672>/</span>setproctitle.c src<span style=color:#f92672>/</span>sha1.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>slowlog.c src<span style=color:#f92672>/</span>sort.c src<span style=color:#f92672>/</span>sparkline.c src<span style=color:#f92672>/</span>syncio.c src<span style=color:#f92672>/</span>t_hash.c src<span style=color:#f92672>/</span>t_list.c src<span style=color:#f92672>/</span>t_set.c src<span style=color:#f92672>/</span>t_string.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>t_zset.c src<span style=color:#f92672>/</span>util.c src<span style=color:#f92672>/</span>ziplist.c src<span style=color:#f92672>/</span>zipmap.c src<span style=color:#f92672>/</span>zmalloc.c
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set(EXECUTABLE_OUTPUT_PATH src)
</span></span><span style=display:flex><span>link_directories(deps<span style=color:#f92672>/</span>linenoise deps<span style=color:#f92672>/</span>lua<span style=color:#f92672>/</span>src deps<span style=color:#f92672>/</span>hiredis)
</span></span><span style=display:flex><span>add_executable(redis<span style=color:#f92672>-</span>server <span style=color:#960050;background-color:#1e0010>$</span>{SRC_SERVER})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>target_include_directories(redis<span style=color:#f92672>-</span>server
</span></span><span style=display:flex><span>        PRIVATE <span style=color:#960050;background-color:#1e0010>$</span>{REDIS_ROOT}<span style=color:#f92672>/</span>deps<span style=color:#f92672>/</span>linenoise
</span></span><span style=display:flex><span>        PRIVATE <span style=color:#960050;background-color:#1e0010>$</span>{REDIS_ROOT}<span style=color:#f92672>/</span>deps<span style=color:#f92672>/</span>hiredis
</span></span><span style=display:flex><span>        PRIVATE <span style=color:#960050;background-color:#1e0010>$</span>{REDIS_ROOT}<span style=color:#f92672>/</span>deps<span style=color:#f92672>/</span>lua<span style=color:#f92672>/</span>src
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>target_link_libraries(redis<span style=color:#f92672>-</span>server
</span></span><span style=display:flex><span>        PRIVATE pthread
</span></span><span style=display:flex><span>        PRIVATE dl
</span></span><span style=display:flex><span>        PRIVATE m
</span></span><span style=display:flex><span>        PRIVATE lua
</span></span><span style=display:flex><span>        PRIVATE linenoise
</span></span><span style=display:flex><span>        PRIVATE hiredis
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set(CLIENT_SRC src<span style=color:#f92672>/</span>redis<span style=color:#f92672>-</span>cli.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>anet.c src<span style=color:#f92672>/</span>sds.c src<span style=color:#f92672>/</span>adlist.c src<span style=color:#f92672>/</span>zmalloc.c
</span></span><span style=display:flex><span>        src<span style=color:#f92672>/</span>release.c src<span style=color:#f92672>/</span>anet.c src<span style=color:#f92672>/</span>ae.c src<span style=color:#f92672>/</span>crc64.c
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>add_executable(redis<span style=color:#f92672>-</span>cli <span style=color:#960050;background-color:#1e0010>$</span>{CLIENT_SRC})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>target_include_directories(redis<span style=color:#f92672>-</span>cli
</span></span><span style=display:flex><span>        PRIVATE <span style=color:#960050;background-color:#1e0010>$</span>{REDIS_ROOT}<span style=color:#f92672>/</span>deps<span style=color:#f92672>/</span>linenoise
</span></span><span style=display:flex><span>        PRIVATE <span style=color:#960050;background-color:#1e0010>$</span>{REDIS_ROOT}<span style=color:#f92672>/</span>deps<span style=color:#f92672>/</span>hiredis
</span></span><span style=display:flex><span>        PRIVATE <span style=color:#960050;background-color:#1e0010>$</span>{REDIS_ROOT}<span style=color:#f92672>/</span>deps<span style=color:#f92672>/</span>lua<span style=color:#f92672>/</span>src
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>target_link_libraries(redis<span style=color:#f92672>-</span>cli
</span></span><span style=display:flex><span>        PRIVATE pthread
</span></span><span style=display:flex><span>        PRIVATE m
</span></span><span style=display:flex><span>        PRIVATE linenoise
</span></span><span style=display:flex><span>        PRIVATE hiredis
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><h2 id=错误处理>错误处理</h2><h3 id=fatal-error-sysepollh-file-not-found>fatal error: &lsquo;sys/epoll.h&rsquo; file not found</h3><p>在macOS下编译会出现这个错误，是因为epoll是linux独有的，macOS上并没有<code>sys/epoll.h</code>头文件，因此编译出错。但macOS上使用<code>kqueue</code>代替了<code>epoll</code>，这里可以直接注释相关代码。</p><p>redis/CMakeLists.txt中注释下列文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>##        src/ae_epoll.c</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##        src/ae_evport.c</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##        src/ae_select.c</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##        src/ae_kqueue.c</span>
</span></span></code></pre></div><h3 id=fatal-error-releaseh-file-not-found>fatal error: &lsquo;release.h&rsquo; file not found</h3><p>在redis目录下执行脚本即可，用于生成缺失的 <code>release.h</code> 文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd src/
</span></span><span style=display:flex><span>sh mkreleasehdr.sh
</span></span></code></pre></div><h2 id=clion导入项目>Clion导入项目</h2><p>直接打开项目，选择 <strong>Open as：CMake project</strong>，打开后就可以直接运行了， <code>redis-serve</code> 即redis服务端， <code>redis-cli</code> 即客户端。</p></section><footer class=post-tags><a href=https://www.vitahlin.com/tags/redis>redis</a></footer><nav class=post-nav><a class=prev href=https://www.vitahlin.com/posts/mysql-design-guideline/><span>←</span><span>Mysql数据库设计规范</span></a>
<a class=next href=https://www.vitahlin.com/posts/mysql-explain/><span>Mysql explain命令详解</span><span>→</span></a></nav></article></main><footer class=footer><p>&copy; 2022 <a href=https://www.vitahlin.com/>Vitah Lin</a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p><p><a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a></p></footer></body></html>