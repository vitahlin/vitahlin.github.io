<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="示例表 表结构 1 2 3 4 5 6 7 8 9 10 11 12 13  DROPTABLEIFEXISTSemployees;CREATETABLE`employees`(`id`INT(11)NOTNULLAUTO_INCREMENT,`name`VARCHAR(24)NOTNULLDEFAULT&amp;#39;&amp;#39;COMMENT&amp;#39;姓名&amp;#39;,`age`INT(11)NOTNULLDEFAULT&amp;#39;0&amp;#39;COMMENT&amp;#39;年龄&amp;#39;,`position`VARCHAR(20)NOTNULLDEFAULT&amp;#39;&amp;#39;COMMENT&amp;#39;职位&amp;#39;,`hire_time`TIMESTAMPNOTNULLDEFAULTCURRENT_TIMESTAMPCOMMENT&amp;#39;入职时间&amp;#39;,PRIMARYKEY(`id`),KEY`idx_name_age_position`(`name`,`age`,`position`)USINGBTREE)ENGINE=InnoDBAUTO_INCREMENT=1DEFAULTCHARSET=utf8COMMENT=&amp;#39;员工记录表&amp;#39;;  表数据 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;LiLei&amp;#39;,22,&amp;#39;manager&amp;#39;,NOW());INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;HanMeimei&amp;#39;,23,&amp;#39;dev&amp;#39;,NOW());INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;Lucy&amp;#39;,23,&amp;#39;dev&amp;#39;,NOW());#插入一些示例数据DROPPROCEDUREIFEXISTSinsert_emp;DELIMITER;;CREATEPROCEDUREinsert_emp()BEGINDECLAREiINT;SETi=1;WHILE(i&amp;lt;=100000)DOINSERTINTOemployees(name,age,position)VALUES(CONCAT(&amp;#39;zhuge&amp;#39;,i),i,&amp;#39;dev&amp;#39;);SETi=i+1;ENDWHILE;END;;DELIMITER;CALLinsert_emp();  联合索引第一个字段用范围查询 会不会走索引 联合索引第一个字段就用范围查找不会走索引，mysql内部可能觉得第一个字段就用范围查找，结果集应该很大，回表效率不高，还不如全表扫描。
1 2 3 4 5 6  EXPLAINSELECT*FROMemployeesWHEREname&amp;gt;&amp;#39;LiLei&amp;#39;ANDage=22ANDposition=&amp;#39;manager&amp;#39;;  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  [ { &amp;#34;id&amp;#34;: 1, &amp;#34;select_type&amp;#34;: &amp;#34;SIMPLE&amp;#34;, &amp;#34;table&amp;#34;: &amp;#34;employees&amp;#34;, &amp;#34;partitions&amp;#34;: null, &amp;#34;type&amp;#34;: &amp;#34;ALL&amp;#34;, &amp;#34;possible_keys&amp;#34;: &amp;#34;idx_name_age_position&amp;#34;, &amp;#34;key&amp;#34;: null, &amp;#34;key_len&amp;#34;: null, &amp;#34;ref&amp;#34;: null, &amp;#34;rows&amp;#34;: 99986, &amp;#34;filtered&amp;#34;: 0."><title>Mysql索引优化实践</title><link rel=canonical href=https://www.vitahlin.com/posts/mysql-indexing-optimization-practices/><link rel=stylesheet href=/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css><meta property="og:title" content="Mysql索引优化实践"><meta property="og:description" content="示例表 表结构 1 2 3 4 5 6 7 8 9 10 11 12 13  DROPTABLEIFEXISTSemployees;CREATETABLE`employees`(`id`INT(11)NOTNULLAUTO_INCREMENT,`name`VARCHAR(24)NOTNULLDEFAULT&amp;#39;&amp;#39;COMMENT&amp;#39;姓名&amp;#39;,`age`INT(11)NOTNULLDEFAULT&amp;#39;0&amp;#39;COMMENT&amp;#39;年龄&amp;#39;,`position`VARCHAR(20)NOTNULLDEFAULT&amp;#39;&amp;#39;COMMENT&amp;#39;职位&amp;#39;,`hire_time`TIMESTAMPNOTNULLDEFAULTCURRENT_TIMESTAMPCOMMENT&amp;#39;入职时间&amp;#39;,PRIMARYKEY(`id`),KEY`idx_name_age_position`(`name`,`age`,`position`)USINGBTREE)ENGINE=InnoDBAUTO_INCREMENT=1DEFAULTCHARSET=utf8COMMENT=&amp;#39;员工记录表&amp;#39;;  表数据 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;LiLei&amp;#39;,22,&amp;#39;manager&amp;#39;,NOW());INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;HanMeimei&amp;#39;,23,&amp;#39;dev&amp;#39;,NOW());INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;Lucy&amp;#39;,23,&amp;#39;dev&amp;#39;,NOW());#插入一些示例数据DROPPROCEDUREIFEXISTSinsert_emp;DELIMITER;;CREATEPROCEDUREinsert_emp()BEGINDECLAREiINT;SETi=1;WHILE(i&amp;lt;=100000)DOINSERTINTOemployees(name,age,position)VALUES(CONCAT(&amp;#39;zhuge&amp;#39;,i),i,&amp;#39;dev&amp;#39;);SETi=i+1;ENDWHILE;END;;DELIMITER;CALLinsert_emp();  联合索引第一个字段用范围查询 会不会走索引 联合索引第一个字段就用范围查找不会走索引，mysql内部可能觉得第一个字段就用范围查找，结果集应该很大，回表效率不高，还不如全表扫描。
1 2 3 4 5 6  EXPLAINSELECT*FROMemployeesWHEREname&amp;gt;&amp;#39;LiLei&amp;#39;ANDage=22ANDposition=&amp;#39;manager&amp;#39;;  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  [ { &amp;#34;id&amp;#34;: 1, &amp;#34;select_type&amp;#34;: &amp;#34;SIMPLE&amp;#34;, &amp;#34;table&amp;#34;: &amp;#34;employees&amp;#34;, &amp;#34;partitions&amp;#34;: null, &amp;#34;type&amp;#34;: &amp;#34;ALL&amp;#34;, &amp;#34;possible_keys&amp;#34;: &amp;#34;idx_name_age_position&amp;#34;, &amp;#34;key&amp;#34;: null, &amp;#34;key_len&amp;#34;: null, &amp;#34;ref&amp;#34;: null, &amp;#34;rows&amp;#34;: 99986, &amp;#34;filtered&amp;#34;: 0."><meta property="og:url" content="https://www.vitahlin.com/posts/mysql-indexing-optimization-practices/"><meta property="og:site_name" content="Vitah Lin"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="mysql"><meta property="article:published_time" content="2022-04-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-12T00:00:00+00:00"><meta name=twitter:title content="Mysql索引优化实践"><meta name=twitter:description content="示例表 表结构 1 2 3 4 5 6 7 8 9 10 11 12 13  DROPTABLEIFEXISTSemployees;CREATETABLE`employees`(`id`INT(11)NOTNULLAUTO_INCREMENT,`name`VARCHAR(24)NOTNULLDEFAULT&amp;#39;&amp;#39;COMMENT&amp;#39;姓名&amp;#39;,`age`INT(11)NOTNULLDEFAULT&amp;#39;0&amp;#39;COMMENT&amp;#39;年龄&amp;#39;,`position`VARCHAR(20)NOTNULLDEFAULT&amp;#39;&amp;#39;COMMENT&amp;#39;职位&amp;#39;,`hire_time`TIMESTAMPNOTNULLDEFAULTCURRENT_TIMESTAMPCOMMENT&amp;#39;入职时间&amp;#39;,PRIMARYKEY(`id`),KEY`idx_name_age_position`(`name`,`age`,`position`)USINGBTREE)ENGINE=InnoDBAUTO_INCREMENT=1DEFAULTCHARSET=utf8COMMENT=&amp;#39;员工记录表&amp;#39;;  表数据 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;LiLei&amp;#39;,22,&amp;#39;manager&amp;#39;,NOW());INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;HanMeimei&amp;#39;,23,&amp;#39;dev&amp;#39;,NOW());INSERTINTOemployees(name,age,position,hire_time)VALUES(&amp;#39;Lucy&amp;#39;,23,&amp;#39;dev&amp;#39;,NOW());#插入一些示例数据DROPPROCEDUREIFEXISTSinsert_emp;DELIMITER;;CREATEPROCEDUREinsert_emp()BEGINDECLAREiINT;SETi=1;WHILE(i&amp;lt;=100000)DOINSERTINTOemployees(name,age,position)VALUES(CONCAT(&amp;#39;zhuge&amp;#39;,i),i,&amp;#39;dev&amp;#39;);SETi=i+1;ENDWHILE;END;;DELIMITER;CALLinsert_emp();  联合索引第一个字段用范围查询 会不会走索引 联合索引第一个字段就用范围查找不会走索引，mysql内部可能觉得第一个字段就用范围查找，结果集应该很大，回表效率不高，还不如全表扫描。
1 2 3 4 5 6  EXPLAINSELECT*FROMemployeesWHEREname&amp;gt;&amp;#39;LiLei&amp;#39;ANDage=22ANDposition=&amp;#39;manager&amp;#39;;  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  [ { &amp;#34;id&amp;#34;: 1, &amp;#34;select_type&amp;#34;: &amp;#34;SIMPLE&amp;#34;, &amp;#34;table&amp;#34;: &amp;#34;employees&amp;#34;, &amp;#34;partitions&amp;#34;: null, &amp;#34;type&amp;#34;: &amp;#34;ALL&amp;#34;, &amp;#34;possible_keys&amp;#34;: &amp;#34;idx_name_age_position&amp;#34;, &amp;#34;key&amp;#34;: null, &amp;#34;key_len&amp;#34;: null, &amp;#34;ref&amp;#34;: null, &amp;#34;rows&amp;#34;: 99986, &amp;#34;filtered&amp;#34;: 0."></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>Vitah Lin</a></h1><h2 class=site-description>深自缄默，如云漂泊</h2></div></header><ol class=social-menu><li><a href=https://github.com/vitahlin target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/mysql/>mysql</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/mysql-indexing-optimization-practices/>Mysql索引优化实践</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Apr 12, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>16 minute read</time></div></footer></div></header><section class=article-content><h2 id=示例表>示例表</h2><h3 id=表结构>表结构</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>employees</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w>        </span><span class=nb>INT</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w>     </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=w>      </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>24</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;姓名&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=w>       </span><span class=nb>INT</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w>     </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;年龄&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=k>position</span><span class=o>`</span><span class=w>  </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;职位&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>hire_time</span><span class=o>`</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w>   </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;入职时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>idx_name_age_position</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=k>position</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>BTREE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>AUTO_INCREMENT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=o>=</span><span class=s1>&#39;员工记录表&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=表数据>表数据</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>employees</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=p>,</span><span class=w> </span><span class=n>hire_time</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;LiLei&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>22</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;manager&#39;</span><span class=p>,</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>employees</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=p>,</span><span class=w> </span><span class=n>hire_time</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;HanMeimei&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>23</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;dev&#39;</span><span class=p>,</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>employees</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=p>,</span><span class=w> </span><span class=n>hire_time</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;Lucy&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>23</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;dev&#39;</span><span class=p>,</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>插入一些示例数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>insert_emp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w> </span><span class=p>;;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>insert_emp</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DECLARE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=nb>INT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>WHILE</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>100000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>DO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>employees</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>CONCAT</span><span class=p>(</span><span class=s1>&#39;zhuge&#39;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>),</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;dev&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>SET</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>END</span><span class=w> </span><span class=n>WHILE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insert_emp</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=联合索引第一个字段用范围查询>联合索引第一个字段用范围查询</h2><h3 id=会不会走索引>会不会走索引</h3><p><strong>联合索引第一个字段就用范围查找不会走索引，mysql内部可能觉得第一个字段就用范围查找，结果集应该很大，回表效率不高，还不如全表扫描。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;manager&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ALL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>99986</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using where&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=强制走索引效果>强制走索引效果</h3><p>使用了强制走索引让联合索引第一个字段范围查找也用索引，扫描的 <code>rows</code> 看上去也少了点，但最终但查找效率不一定会比全表扫描高，因为回表效率不高。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=k>FORCE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=p>(</span><span class=n>idx_name_age_position</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;manager&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>49993</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=强制走索引和不走索引效率对比>强制走索引和不走索引效率对比</h3><p>我们先关闭查询缓存，避免影响查询结果。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>#</span> <span class=err>关闭查询缓存</span>
</span></span><span class=line><span class=cl><span class=err>set</span> <span class=err>global</span> <span class=err>query_cache_size</span> <span class=err>=</span> <span class=mi>0</span><span class=err>;</span>
</span></span><span class=line><span class=cl><span class=err>set</span> <span class=err>global</span> <span class=err>query_cache_type</span> <span class=err>=</span> <span class=mi>0</span><span class=err>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=不走索引结果>不走索引结果</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>SELECT *
</span></span><span class=line><span class=cl>FROM employees
</span></span><span class=line><span class=cl>WHERE name &gt; <span class=s1>&#39;LiLei&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vitah&gt; SELECT *
</span></span><span class=line><span class=cl>       FROM employees
</span></span><span class=line><span class=cl>       WHERE name &gt; <span class=s1>&#39;LiLei&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2022-03-26 22:11:22<span class=o>]</span> 在 <span class=m>119</span> ms <span class=o>(</span>execution: <span class=m>14</span> ms, fetching: <span class=m>105</span> ms<span class=o>)</span> 内检索到从 <span class=m>1</span> 开始的 2,000 行
</span></span></code></pre></td></tr></table></div></div><h4 id=强制走索引结果>强制走索引结果</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>SELECT *
</span></span><span class=line><span class=cl>FROM employees force index <span class=o>(</span>idx_name_age_position<span class=o>)</span>
</span></span><span class=line><span class=cl>WHERE name &gt; <span class=s1>&#39;LiLei&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vitah&gt; SELECT *
</span></span><span class=line><span class=cl>       FROM employees force index <span class=o>(</span>idx_name_age_position<span class=o>)</span>
</span></span><span class=line><span class=cl>       WHERE name &gt; <span class=s1>&#39;LiLei&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2022-03-26 22:11:48<span class=o>]</span> 在 <span class=m>140</span> ms <span class=o>(</span>execution: <span class=m>16</span> ms, fetching: <span class=m>124</span> ms<span class=o>)</span> 内检索到从 <span class=m>1</span> 开始的 2,000 行
</span></span></code></pre></td></tr></table></div></div><p>可以看到，强制走索引的效率甚至还不如不走索引的执行效果。</p><h4 id=如何优化>如何优化？</h4><p>我们可以使用覆盖索引来优化。什么是覆盖索引？</p><blockquote><p>创建一个索引，该索引包含查询中用到的所有字段，称为“覆盖索引”。 使用覆盖索引，MySQL 只需要通过索引就可以查找和返回查询所需要的数据，而不必在使用索引处理数据之后再进行回表操作。 覆盖索引可以一次性完成查询工作，有效减少IO，提高查询效率。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;mana er&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>49954</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using where; Using index&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=in和or查询>in和or查询</h2><h3 id=是否会走索引>是否会走索引？</h3><p>在数据量比较大的情况下会走索引，在表记录不多的情况会选择全表扫描。</p><h4 id=大数据量情况>大数据量情况</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;LiLei&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;HanMeimei&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Lucy&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;manager&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;140&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到，<code>key</code> 为 <code>idx_name_age_position</code> 用到了索引。</p><h4 id=小数据量情况>小数据量情况</h4><p>复制同样结构的表，往里面插入3条数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>CREATE TABLE <span class=sb>`</span>employees_copy<span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=sb>`</span>id<span class=sb>`</span>        int<span class=o>(</span>11<span class=o>)</span>     NOT NULL AUTO_INCREMENT,
</span></span><span class=line><span class=cl>    <span class=sb>`</span>name<span class=sb>`</span>      varchar<span class=o>(</span>24<span class=o>)</span> NOT NULL DEFAULT <span class=s1>&#39;&#39;</span> COMMENT <span class=s1>&#39;姓名&#39;</span>,
</span></span><span class=line><span class=cl>    <span class=sb>`</span>age<span class=sb>`</span>       int<span class=o>(</span>11<span class=o>)</span>     NOT NULL DEFAULT <span class=s1>&#39;0&#39;</span> COMMENT <span class=s1>&#39;年龄&#39;</span>,
</span></span><span class=line><span class=cl>    <span class=sb>`</span>position<span class=sb>`</span>  varchar<span class=o>(</span>20<span class=o>)</span> NOT NULL DEFAULT <span class=s1>&#39;&#39;</span> COMMENT <span class=s1>&#39;职位&#39;</span>,
</span></span><span class=line><span class=cl>    <span class=sb>`</span>hire_time<span class=sb>`</span> timestamp   NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class=s1>&#39;入职时间&#39;</span>,
</span></span><span class=line><span class=cl>    PRIMARY KEY <span class=o>(</span><span class=sb>`</span>id<span class=sb>`</span><span class=o>)</span>,
</span></span><span class=line><span class=cl>    KEY <span class=sb>`</span>idx_name_age_position<span class=sb>`</span> <span class=o>(</span><span class=sb>`</span>name<span class=sb>`</span>, <span class=sb>`</span>age<span class=sb>`</span>, <span class=sb>`</span>position<span class=sb>`</span><span class=o>)</span> USING BTREE
</span></span><span class=line><span class=cl><span class=o>)</span> <span class=nv>ENGINE</span> <span class=o>=</span> InnoDB
</span></span><span class=line><span class=cl>  <span class=nv>AUTO_INCREMENT</span> <span class=o>=</span> <span class=m>100004</span>
</span></span><span class=line><span class=cl>  DEFAULT <span class=nv>CHARSET</span> <span class=o>=</span> utf8 <span class=nv>COMMENT</span> <span class=o>=</span><span class=s1>&#39;员工记录表&#39;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>NSERT INTO employees_copy<span class=o>(</span>name, age, position, hire_time<span class=o>)</span>
</span></span><span class=line><span class=cl>VALUES <span class=o>(</span><span class=s1>&#39;LiLei&#39;</span>, 22, <span class=s1>&#39;manager&#39;</span>, NOW<span class=o>())</span><span class=p>;</span>
</span></span><span class=line><span class=cl>INSERT INTO employees_copy<span class=o>(</span>name, age, position, hire_time<span class=o>)</span>
</span></span><span class=line><span class=cl>VALUES <span class=o>(</span><span class=s1>&#39;HanMeimei&#39;</span>, 23, <span class=s1>&#39;dev&#39;</span>, NOW<span class=o>())</span><span class=p>;</span>
</span></span><span class=line><span class=cl>INSERT INTO employees_copy<span class=o>(</span>name, age, position, hire_time<span class=o>)</span>
</span></span><span class=line><span class=cl>VALUES <span class=o>(</span><span class=s1>&#39;Lucy&#39;</span>, 23, <span class=s1>&#39;dev&#39;</span>, NOW<span class=o>())</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>查询语句：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees_copy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;LiLei&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;HanMeimei&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Lucy&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;manager&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>执行结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees_copy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ALL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using where&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><code>type</code> 为 <code>ALL</code>，走的是全表扫描。</p><h2 id=like-kk-查询>like <code>kk%</code> 查询</h2><h3 id=会不会走索引-1>会不会走索引？</h3><h4 id=大数据量查询>大数据量查询</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;LiLei%&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;manager&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>分析结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;140&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=小数据量查询>小数据量查询</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>EXPLAIN
</span></span><span class=line><span class=cl>SELECT *
</span></span><span class=line><span class=cl>FROM employees_copy
</span></span><span class=line><span class=cl>WHERE name LIKE <span class=s1>&#39;LiLei%&#39;</span>
</span></span><span class=line><span class=cl>  AND <span class=nv>age</span> <span class=o>=</span> <span class=m>22</span>
</span></span><span class=line><span class=cl>  AND <span class=nv>position</span> <span class=o>=</span> <span class=s1>&#39;manager&#39;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees_copy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;140&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mf>33.33</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>所以，<code>like KK%</code> 语句一般情况下都会走索引，为什么呢？这里其实是用到了<strong>索引下推优化</strong>。</p><h3 id=索引下推>索引下推</h3><p>对于辅助的联合索引 <code>(name,age,posisiton)</code>，正常情况按照最左前缀原则，查询语句只会走 <code>name</code> 字段索引，
因为 <code>name</code> 字段过滤完，得到的索引行里的 <code>age</code> 和 <code>position</code> 是无序的，无法很好的利用索引。
在Mysql5.6之前的版本，这个查询只能在联合索引里匹配到名字是 <code>LiLei</code> 开头的索引，
然后拿这些索引对应的主键逐个回表，到主键索引上找出对应记录，再比较 <code>age</code> 和 <code>position</code> 两个字段的值是否符合。</p><p>Mysql5.6 引入了索引下推优化，可以在索引遍历过程中，对索引包含的所有字段做判断，过滤掉不符合条件的记录再回表，可以有效的减少回表次数。
使用了索引下推之后，上面那个查询在联合索引里匹配到名字符合的索引之后，同时还会在索引里面过滤 <code>age</code> 和 <code>position</code> 这两个字段，
拿着过滤完剩下的索引的主键ID再回表。索引下推会减少回表次数，对于InnoDB引擎的表索引下推只能用于二级索引，
InnoDB的主键索引树叶子节点上保存的是全行数据，所有这个时候索引下推并不会减少查询全行数据的效果。</p><h4 id=范围查找是否会用到索引下推>范围查找是否会用到索引下推？</h4><p>没有。猜测原因：估计应该是Mysql认为范围查找过滤的结果集过大，<code>like kk%</code> 在绝大多数情况下过滤后的结果集小，所以mysql选择给 <code>like kk%</code> 用了索引下推优化，
当然这也不是绝对的，有时 <code>like kk%</code> 也可能不用索引下推。</p><h2 id=order-by-与group-by>order by 与group by</h2><h3 id=case1-order-by用到了联合索引的中间字段>case1: order by用到了联合索引的中间字段</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>position</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;dev&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;const&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>最左前缀法则，中间字段不能断，因此查询用到了 <code>name</code> 索引，从 <code>key_len=74</code> 也能看出。
<code>age</code> 列用在了排序之中，因为 <code>extra</code> 里面没有 <code>using filesort</code>。</p><h3 id=case2-order-by用到了联合索引的最后一个字段>case2: order by用到了联合索引的最后一个字段</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>position</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;const&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition; Using filesort&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><code>key_len=74</code>，查询使用了 <code>name</code> 索引。由于用了 <code>position</code> 进行排序，跳过了 <code>age</code>，出现了 <code>Using filesort</code>。</p><h3 id=case3>case3</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;const&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>查询只用到了索引 <code>name</code>，<code>age</code> 和 <code>position</code> 用于排序，无 <code>Using filesort</code>。</p><h3 id=case4>case4</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>position</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;const&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition; Using filesort&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>和case2 中结果一样。</p><h3 id=case5>case5</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>position</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;78&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;const,const&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>与 case4 对比，因为 <code>age</code> 为常量，在排序中被优化，所以索引未颠倒，不会出现 <code>Using filesort</code>。</p><h3 id=case6>case6</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;LiLei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=k>ASC</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;const&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition; Using filesort&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>虽然排序的字段与索引顺序一样，且 <strong><code>order by</code> 默认升序</strong>，这里 <code>position desc</code> 变成了降序，导致与索引的排序方式不同，
从而产生了 <code>Using filesort</code>。Mysql8以上版本有降序索引可以支持该查询方式。</p><h3 id=case7>case7</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;LiLei&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Hanmeimei&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index condition; Using filesort&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>对于排序来说，多个相等条件等于范围查询。</strong></p><h3 id=case8>case8</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ALL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>100269</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>50</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using where; Using filesort&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到，上述查询并不会用到索引。但是可以使用覆盖索引进行优化。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=k>position</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;74&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>50134</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using where; Using index&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=优化总结>优化总结</h3><ul><li>mysql支持两种方式的排序 <code>filesort</code> 和 <code>index</code>，<code>Using index</code> 指扫描索引本身完成排序。<code>index</code>效率高，<code>filesort</code>效率低。</li><li>order by 满足两种情况会使用 Using index<ul><li>order by 语句使用索引最左前列</li><li>使用 where 子句与 order by 子句条件列组合满足索引最左前列</li></ul></li><li>尽量在索引列上完成排序，遵循索引建立（索引创建的顺序）时的最左前缀法则</li><li>如果 order by 的条件不在索引列上，就会产生 Using filesort</li><li>能用覆盖索引尽量用覆盖索引</li><li>group by 与 order by 很类似，实质是先排序后分组，遵循索引创建顺序的最左前缀法则。对于 group by 的优化如果不需要排序可以加上 order by null禁止排序。注意，where 高于 having，能写在 where 中的限定条件就不要去having 限定了。</li></ul><h2 id=using-filesort文件排序原理>Using filesort文件排序原理</h2><h3 id=filesort-文件排序方式>filesort 文件排序方式</h3><h4 id=单路排序>单路排序</h4><p>一次性取出满足条件所有字段，然后在 sort buffer 中进行排序；用 trace 工具可以看到 sort_model 信息里面显示 &lt;sort_key, additional_fields> 或者 &lt;sort_key, packed_additional_fields></p><h4 id=双路排序>双路排序</h4><p>又叫回表排序方式。先根据对于条件取出排序字段和可以直接定位行数据的行ID，然后在 sort buffer 中进行排序，排序完成后需要再次取回其他需要的字段；用trace工具可以看到 sort_model 信息里面显示 &lt;sort_key, rowid></p><h4 id=什么时候用单路排序什么时候用双路排序>什么时候用单路排序什么时候用双路排序？</h4><p>mysql 通过比较系统变量 max_length_for_sort_data(默认1024字节)的大小和需要查询的字段总大小来判断使用哪种排序模式</p><ul><li>如果字段总长度小于max_length_for_sort_data，使用单路排序</li><li>字段总长度大于max_length_for_sort_data，使用双路排序</li></ul><h3 id=filesort文件排序示例>filesort文件排序示例</h3><h4 id=单路排序示例>单路排序示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=k>SESSION</span><span class=w> </span><span class=n>OPTIMIZER_TRACE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;enabled=on&#39;</span><span class=p>,</span><span class=n>END_MARKERS_IN_JSON</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>ON</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;lilei&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>position</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>optimizer_trace</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;join_preparation&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;select#&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;expanded_query&#34;</span><span class=p>:</span> <span class=s2>&#34;/* select#1 */ select `employees`.`id` AS `id`,`employees`.`name` AS `name`,`employees`.`age` AS `age`,`employees`.`position` AS `position`,`employees`.`hire_time` AS `hire_time` from `employees` where (`employees`.`name` = &#39;zhuge&#39;) order by `employees`.`position`&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=err>/*</span> <span class=err>join_preparation</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;join_optimization&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;select#&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;condition_processing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;condition&#34;</span><span class=p>:</span> <span class=s2>&#34;WHERE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;original_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;transformation&#34;</span><span class=p>:</span> <span class=s2>&#34;equality_propagation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;resulting_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;transformation&#34;</span><span class=p>:</span> <span class=s2>&#34;constant_propagation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;resulting_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;transformation&#34;</span><span class=p>:</span> <span class=s2>&#34;trivial_condition_removal&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;resulting_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>condition_processing</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;substitute_generated_columns&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>substitute_generated_columns</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;table_dependencies&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;row_may_be_null&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;map_bit&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;depends_on_map_bits&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span> <span class=err>/*</span> <span class=err>depends_on_map_bits</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>table_dependencies</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ref_optimizer_key_uses&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;field&#34;</span><span class=p>:</span> <span class=s2>&#34;name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;equals&#34;</span><span class=p>:</span> <span class=s2>&#34;&#39;zhuge&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;null_rejecting&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>ref_optimizer_key_uses</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;rows_estimation&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;range_analysis&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;table_scan&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>100269</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;cost&#34;</span><span class=p>:</span> <span class=mi>20345</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span> <span class=err>/*</span> <span class=err>table_scan</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;potential_range_indexes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;PRIMARY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;usable&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;not_applicable&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;usable&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;key_parts&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;age&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;id&#34;</span>
</span></span><span class=line><span class=cl>                      <span class=p>]</span> <span class=err>/*</span> <span class=err>key_parts</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>]</span> <span class=err>/*</span> <span class=err>potential_range_indexes</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;setup_range_conditions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>]</span> <span class=err>/*</span> <span class=err>setup_range_conditions</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;group_index_range&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;not_group_by_or_distinct&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span> <span class=err>/*</span> <span class=err>group_index_range</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;analyzing_range_alternatives&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;range_scan_alternatives&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;ranges&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                          <span class=s2>&#34;zhuge &lt;= name &lt;= zhuge&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>]</span> <span class=err>/*</span> <span class=err>ranges</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;index_dives_for_eq_ranges&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;rowid_ordered&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;using_mrr&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;index_only&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;cost&#34;</span><span class=p>:</span> <span class=mf>2.21</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>]</span> <span class=err>/*</span> <span class=err>range_scan_alternatives</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;analyzing_roworder_intersect&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;usable&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;too_few_roworder_scans&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span> <span class=err>/*</span> <span class=err>analyzing_roworder_intersect</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span> <span class=err>/*</span> <span class=err>analyzing_range_alternatives</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;chosen_range_access_summary&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;range_access_plan&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range_scan&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;ranges&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;zhuge &lt;= name &lt;= zhuge&#34;</span>
</span></span><span class=line><span class=cl>                      <span class=p>]</span> <span class=err>/*</span> <span class=err>ranges</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span> <span class=err>/*</span> <span class=err>range_access_plan</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;rows_for_plan&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;cost_for_plan&#34;</span><span class=p>:</span> <span class=mf>2.21</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span> <span class=err>/*</span> <span class=err>chosen_range_access_summary</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=err>/*</span> <span class=err>range_analysis</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>rows_estimation</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;considered_execution_plans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;plan_prefix&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span> <span class=err>/*</span> <span class=err>plan_prefix</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;best_access_path&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;considered_access_paths&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;access_type&#34;</span><span class=p>:</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;cost&#34;</span><span class=p>:</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                    <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;access_type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;range_details&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;used_index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span> <span class=err>/*</span> <span class=err>range_details</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;heuristic_index_cheaper&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>]</span> <span class=err>/*</span> <span class=err>considered_access_paths</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=err>/*</span> <span class=err>best_access_path</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;condition_filtering_pct&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;rows_for_plan&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;cost_for_plan&#34;</span><span class=p>:</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>considered_execution_plans</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attaching_conditions_to_tables&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;original_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attached_conditions_computation&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>attached_conditions_computation</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attached_conditions_summary&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;attached&#34;</span><span class=p>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>attached_conditions_summary</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>attaching_conditions_to_tables</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;clause_processing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;clause&#34;</span><span class=p>:</span> <span class=s2>&#34;ORDER BY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;original_clause&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`.`position`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;item&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`.`position`&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>items</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;resulting_clause_is_simple&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;resulting_clause&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`.`position`&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>clause_processing</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;added_back_ref_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;((`employees`.`name` &lt;=&gt; &#39;zhuge&#39;))&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;reconsidering_access_paths_for_index_ordering&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;clause&#34;</span><span class=p>:</span> <span class=s2>&#34;ORDER BY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;index_order_summary&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;index_provides_order&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;order_direction&#34;</span><span class=p>:</span> <span class=s2>&#34;undefined&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;plan_changed&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span> <span class=err>/*</span> <span class=err>index_order_summary</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>reconsidering_access_paths_for_index_ordering</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;refine_plan&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;pushed_index_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` &lt;=&gt; &#39;zhuge&#39;)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table_condition_attached&#34;</span><span class=p>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>refine_plan</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=err>/*</span> <span class=err>join_optimization</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;join_execution&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;select#&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filesort_information&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;direction&#34;</span><span class=p>:</span> <span class=s2>&#34;asc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;field&#34;</span><span class=p>:</span> <span class=s2>&#34;position&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>filesort_information</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filesort_priority_queue_optimization&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;usable&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;not applicable (no LIMIT)&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>filesort_priority_queue_optimization</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filesort_execution&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>filesort_execution</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=err>/*</span> <span class=err>文件排序信息</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filesort_summary&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=err>/*</span> <span class=err>预扫描行数</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=err>/*</span> <span class=err>参与排序的行</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;examined_rows&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=err>/*</span> <span class=err>使用临时文件的个数，这个值为0代表全部使用sort_buffer内存排序，否则使用的磁盘文件排序</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;number_of_tmp_files&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=err>/*</span> <span class=err>排序缓存的大小，单位Byte</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;sort_buffer_size&#34;</span><span class=p>:</span> <span class=mi>262056</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=err>/*</span> <span class=err>排序方式，这里是单路排序</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;sort_mode&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;sort_key, packed_additional_fields&gt;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>filesort_summary</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=err>/*</span> <span class=err>join_execution</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>单路排序过程</p><ol><li>从索引name找到第一个满足条件name=&lsquo;lilei&rsquo; 的主键ID</li><li>根据主键ID取出整行所有字段的值，存sort_buffer中</li><li>从索引name找到下一个满足条件的主键ID</li><li>重复2，3步骤知道条件不满足 name=&lsquo;lilei&rsquo;</li><li>对sort_buffer中的数据按照字段position进行排序</li><li>返回结果给客户端</li></ol><h4 id=双路排序示例>双路排序示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=n>MAX_LENGTH_FOR_SORT_DATA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;zhuge&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>position</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>optimizer_trace</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;join_preparation&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;select#&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;expanded_query&#34;</span><span class=p>:</span> <span class=s2>&#34;/* select#1 */ select `employees`.`id` AS `id`,`employees`.`name` AS `name`,`employees`.`age` AS `age`,`employees`.`position` AS `position`,`employees`.`hire_time` AS `hire_time` from `employees` where (`employees`.`name` = &#39;zhuge&#39;) order by `employees`.`position`&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=err>/*</span> <span class=err>join_preparation</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;join_optimization&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;select#&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;condition_processing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;condition&#34;</span><span class=p>:</span> <span class=s2>&#34;WHERE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;original_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;transformation&#34;</span><span class=p>:</span> <span class=s2>&#34;equality_propagation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;resulting_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;transformation&#34;</span><span class=p>:</span> <span class=s2>&#34;constant_propagation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;resulting_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;transformation&#34;</span><span class=p>:</span> <span class=s2>&#34;trivial_condition_removal&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;resulting_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>condition_processing</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;substitute_generated_columns&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>substitute_generated_columns</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;table_dependencies&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;row_may_be_null&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;map_bit&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;depends_on_map_bits&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span> <span class=err>/*</span> <span class=err>depends_on_map_bits</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>table_dependencies</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;ref_optimizer_key_uses&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;field&#34;</span><span class=p>:</span> <span class=s2>&#34;name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;equals&#34;</span><span class=p>:</span> <span class=s2>&#34;&#39;zhuge&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;null_rejecting&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>ref_optimizer_key_uses</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;rows_estimation&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;range_analysis&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;table_scan&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>100269</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;cost&#34;</span><span class=p>:</span> <span class=mi>20345</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span> <span class=err>/*</span> <span class=err>table_scan</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;potential_range_indexes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;PRIMARY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;usable&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;not_applicable&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;usable&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;key_parts&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;age&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;id&#34;</span>
</span></span><span class=line><span class=cl>                      <span class=p>]</span> <span class=err>/*</span> <span class=err>key_parts</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>]</span> <span class=err>/*</span> <span class=err>potential_range_indexes</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;setup_range_conditions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>]</span> <span class=err>/*</span> <span class=err>setup_range_conditions</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;group_index_range&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;not_group_by_or_distinct&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span> <span class=err>/*</span> <span class=err>group_index_range</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;analyzing_range_alternatives&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;range_scan_alternatives&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;ranges&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                          <span class=s2>&#34;zhuge &lt;= name &lt;= zhuge&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>]</span> <span class=err>/*</span> <span class=err>ranges</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;index_dives_for_eq_ranges&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;rowid_ordered&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;using_mrr&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;index_only&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;cost&#34;</span><span class=p>:</span> <span class=mf>2.21</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>]</span> <span class=err>/*</span> <span class=err>range_scan_alternatives</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;analyzing_roworder_intersect&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;usable&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;too_few_roworder_scans&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span> <span class=err>/*</span> <span class=err>analyzing_roworder_intersect</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span> <span class=err>/*</span> <span class=err>analyzing_range_alternatives</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;chosen_range_access_summary&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;range_access_plan&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range_scan&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;ranges&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;zhuge &lt;= name &lt;= zhuge&#34;</span>
</span></span><span class=line><span class=cl>                      <span class=p>]</span> <span class=err>/*</span> <span class=err>ranges</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span> <span class=err>/*</span> <span class=err>range_access_plan</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;rows_for_plan&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;cost_for_plan&#34;</span><span class=p>:</span> <span class=mf>2.21</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span> <span class=err>/*</span> <span class=err>chosen_range_access_summary</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=err>/*</span> <span class=err>range_analysis</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>rows_estimation</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;considered_execution_plans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;plan_prefix&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span> <span class=err>/*</span> <span class=err>plan_prefix</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;best_access_path&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;considered_access_paths&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;access_type&#34;</span><span class=p>:</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;cost&#34;</span><span class=p>:</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                    <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;access_type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;range_details&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;used_index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span> <span class=err>/*</span> <span class=err>range_details</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;heuristic_index_cheaper&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>]</span> <span class=err>/*</span> <span class=err>considered_access_paths</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=err>/*</span> <span class=err>best_access_path</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;condition_filtering_pct&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;rows_for_plan&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;cost_for_plan&#34;</span><span class=p>:</span> <span class=mf>1.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;chosen&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>considered_execution_plans</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attaching_conditions_to_tables&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;original_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` = &#39;zhuge&#39;)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attached_conditions_computation&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>attached_conditions_computation</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attached_conditions_summary&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;attached&#34;</span><span class=p>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>attached_conditions_summary</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>attaching_conditions_to_tables</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;clause_processing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;clause&#34;</span><span class=p>:</span> <span class=s2>&#34;ORDER BY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;original_clause&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`.`position`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;item&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`.`position`&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>items</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;resulting_clause_is_simple&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;resulting_clause&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`.`position`&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>clause_processing</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;added_back_ref_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;((`employees`.`name` &lt;=&gt; &#39;zhuge&#39;))&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;reconsidering_access_paths_for_index_ordering&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;clause&#34;</span><span class=p>:</span> <span class=s2>&#34;ORDER BY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;index_order_summary&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;index_provides_order&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;order_direction&#34;</span><span class=p>:</span> <span class=s2>&#34;undefined&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;plan_changed&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span> <span class=err>/*</span> <span class=err>index_order_summary</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>reconsidering_access_paths_for_index_ordering</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;refine_plan&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;pushed_index_condition&#34;</span><span class=p>:</span> <span class=s2>&#34;(`employees`.`name` &lt;=&gt; &#39;zhuge&#39;)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table_condition_attached&#34;</span><span class=p>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>refine_plan</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=err>/*</span> <span class=err>join_optimization</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;join_execution&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;select#&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filesort_information&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;direction&#34;</span><span class=p>:</span> <span class=s2>&#34;asc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;`employees`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;field&#34;</span><span class=p>:</span> <span class=s2>&#34;position&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>filesort_information</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filesort_priority_queue_optimization&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;usable&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;cause&#34;</span><span class=p>:</span> <span class=s2>&#34;not applicable (no LIMIT)&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>filesort_priority_queue_optimization</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filesort_execution&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span> <span class=err>/*</span> <span class=err>filesort_execution</span> <span class=err>*/</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filesort_summary&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;examined_rows&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;number_of_tmp_files&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;sort_buffer_size&#34;</span><span class=p>:</span> <span class=mi>262136</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;sort_mode&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;sort_key, rowid&gt;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=err>/*</span> <span class=err>filesort_summary</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=err>/*</span> <span class=err>join_execution</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span> <span class=err>/*</span> <span class=err>steps</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到这里的，sort_mode值为&lt;sort_key, rowid>，这里已经变为双路排序。</p><p>双路排序过程</p><ol><li>从索引name找到第一个满足条件name=&lsquo;lilei&rsquo; 的主键ID</li><li>根据主键ID取出整行，把排序字段position和主键ID这两个字段放到sort_buffer中</li><li>从索引name找到下一个满足条件的主键ID</li><li>重复2，3步骤知道条件不满足 name=&lsquo;lilei&rsquo;</li><li>对sort_buffer中的字段position和主键ID按照字段position进行排序</li><li>遍历排序好的ID和字段position，按照主键ID值回到原表中取出所有字段的值返回给客户端</li></ol><h4 id=两种排序方式对比>两种排序方式对比</h4><p>单路排序会把所有需要查询的字段都放到 sort buffer 中，而双路排序只会把主键 和需要排序的字段放到 sort buffer 中进行排序，然后再通过主键回到原表查询需要的字段。
如果 MySQL 排序内存 sort_buffer 配置的比较小并且没有条件继续增加了，可以适当把 max_length_for_sort_data 配置小点，让优化器选择使用双路排序算法，可以在sort_buffer 中一次排序更 多的行，只是需要再根据主键回到原表取数据。
如果 MySQL 排序内存有条件可以配置比较大，可以适当增大max_length_for_sort_data 的值，让优化器 优先选择全字段排序(单路排序)，把需要的字段放到 sort_buffer 中，这样排序后就会直接从内存里返回查询结果了。
所以，MySQL通过 max_length_for_sort_data 这个参数来控制排序，在不同场景使用不同的排序模式， 从而提升排序效率。</p><p>注意，如果全部使用sort_buffer内存排序一般情况下效率会高于磁盘文件排序，但不能因为这个就随便增 大sort_buffer(默认1M)，mysql很多参数设置都是做过优化的，不要轻易调整。</p><h2 id=分页查询优化>分页查询优化</h2><h3 id=普通的分页查询>普通的分页查询</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>10000</span><span class=p>,</span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ALL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>100269</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>上述查询从表中取出从10000开始的5行记录。看似只查询了5条记录，实际上条SQL是先读取10005条记录，然后抛弃前10000条记录读到后面10条想要的记录。因此要查询一张大表比较靠后的数据，执行效率是非常低的。</p><h3 id=常见的优化>常见的优化</h3><h4 id=自增且连续的主键排序的分页查询>自增且连续的主键排序的分页查询</h4><p>当ID都是自增且连续主键排序，可以将上述查询换成:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;range&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;PRIMARY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;PRIMARY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>50134</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using where&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>缺点：</p><ul><li>在很多场景不实用，因为表中可能某些记录被删，主键不连续导致结果不一致。</li><li>如果原来SQL 是order by 非主键的字段，按照这种优化会导致两条SQL结果不一致。</li></ul><h4 id=非主键字段排序的分页查询>非主键字段排序的分页查询</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>90000</span><span class=p>,</span><span class=mi>5</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;SIMPLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ALL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>100269</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using filesort&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>查询并没有使用name字段的索引。具体原因是扫描整个索引并查找到没有索引的行的成本比扫描全表的成本更高，所以优化器放弃使用索引。</p><p>那么如何优化呢？
关键是让排序时返回的字段尽可能少，所以可以让排序和分页操作先查出主键，再根据主键查到对应的记录，SQL改写如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=n>e</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>90000</span><span class=p>,</span><span class=mi>5</span><span class=p>)</span><span class=w> </span><span class=n>ed</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ed</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;PRIMARY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;derived2&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ALL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>90005</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;PRIMARY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;e&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;eq_ref&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=s2>&#34;PRIMARY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;PRIMARY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;ed.id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;select_type&#34;</span><span class=p>:</span> <span class=s2>&#34;DERIVED&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;table&#34;</span><span class=p>:</span> <span class=s2>&#34;employees&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;partitions&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;index&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;possible_keys&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_name_age_position&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;key_len&#34;</span><span class=p>:</span> <span class=s2>&#34;140&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rows&#34;</span><span class=p>:</span> <span class=mi>90005</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filtered&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Extra&#34;</span><span class=p>:</span> <span class=s2>&#34;Using index&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/mysql/>mysql</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-ND 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/posts/mysql-how-to-choose-the-right-index/><div class=article-details><h2 class=article-title>Mysql如何选择合适的索引</h2></div></a></article><article><a href=/posts/mysql-indexing-optimization-rules/><div class=article-details><h2 class=article-title>Mysql索引优化规则</h2></div></a></article><article><a href=/posts/instruction-of-mysql-explain/><div class=article-details><h2 class=article-title>Mysql explain命令介绍</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2022 Vitah Lin</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#示例表>示例表</a><ul><li><a href=#表结构>表结构</a></li><li><a href=#表数据>表数据</a></li></ul></li><li><a href=#联合索引第一个字段用范围查询>联合索引第一个字段用范围查询</a><ul><li><a href=#会不会走索引>会不会走索引</a></li><li><a href=#强制走索引效果>强制走索引效果</a></li><li><a href=#强制走索引和不走索引效率对比>强制走索引和不走索引效率对比</a><ul><li><a href=#不走索引结果>不走索引结果</a></li><li><a href=#强制走索引结果>强制走索引结果</a></li><li><a href=#如何优化>如何优化？</a></li></ul></li></ul></li><li><a href=#in和or查询>in和or查询</a><ul><li><a href=#是否会走索引>是否会走索引？</a><ul><li><a href=#大数据量情况>大数据量情况</a></li><li><a href=#小数据量情况>小数据量情况</a></li></ul></li></ul></li><li><a href=#like-kk-查询>like <code>kk%</code> 查询</a><ul><li><a href=#会不会走索引-1>会不会走索引？</a><ul><li><a href=#大数据量查询>大数据量查询</a></li><li><a href=#小数据量查询>小数据量查询</a></li></ul></li><li><a href=#索引下推>索引下推</a><ul><li><a href=#范围查找是否会用到索引下推>范围查找是否会用到索引下推？</a></li></ul></li></ul></li><li><a href=#order-by-与group-by>order by 与group by</a><ul><li><a href=#case1-order-by用到了联合索引的中间字段>case1: order by用到了联合索引的中间字段</a></li><li><a href=#case2-order-by用到了联合索引的最后一个字段>case2: order by用到了联合索引的最后一个字段</a></li><li><a href=#case3>case3</a></li><li><a href=#case4>case4</a></li><li><a href=#case5>case5</a></li><li><a href=#case6>case6</a></li><li><a href=#case7>case7</a></li><li><a href=#case8>case8</a></li><li><a href=#优化总结>优化总结</a></li></ul></li><li><a href=#using-filesort文件排序原理>Using filesort文件排序原理</a><ul><li><a href=#filesort-文件排序方式>filesort 文件排序方式</a><ul><li><a href=#单路排序>单路排序</a></li><li><a href=#双路排序>双路排序</a></li><li><a href=#什么时候用单路排序什么时候用双路排序>什么时候用单路排序什么时候用双路排序？</a></li></ul></li><li><a href=#filesort文件排序示例>filesort文件排序示例</a><ul><li><a href=#单路排序示例>单路排序示例</a></li><li><a href=#双路排序示例>双路排序示例</a></li><li><a href=#两种排序方式对比>两种排序方式对比</a></li></ul></li></ul></li><li><a href=#分页查询优化>分页查询优化</a><ul><li><a href=#普通的分页查询>普通的分页查询</a></li><li><a href=#常见的优化>常见的优化</a><ul><li><a href=#自增且连续的主键排序的分页查询>自增且连续的主键排序的分页查询</a></li><li><a href=#非主键字段排序的分页查询>非主键字段排序的分页查询</a></li></ul></li></ul></li></ul></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>